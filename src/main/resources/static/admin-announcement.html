<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公告管理 - 智慧宾馆管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: #f5f6fa; min-height: 100vh; font-family: '微软雅黑', Arial, Roboto, sans-serif; }
        .navbar { background: #2563eb; color: #fff; box-shadow: 0 2px 12px rgba(37,99,235,0.10); }
        .navbar-brand { color: #fff !important; font-weight: bold; font-size: 1.2rem; letter-spacing: 2px; }
        .main-box { background: #fff; border-radius: 18px; box-shadow: 0 6px 32px rgba(37,99,235,0.10); padding: 40px; max-width: 700px; margin: 40px auto 0 auto; }
        .main-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 24px; color: #2563eb; text-align: center; }
        .announcement-card { background: #f1f5ff; border-radius: 12px; box-shadow: 0 2px 8px rgba(37,99,235,0.08); padding: 18px 24px; margin-bottom: 18px; display: flex; align-items: center; justify-content: space-between; }
        .announcement-content { font-size: 1.08rem; }
        .btn-outline-danger, .btn-outline-primary { border-radius: 8px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="bi bi-building me-2"></i>智慧宾馆管理系统</a>
            <div class="d-flex">
                <button class="btn btn-outline-secondary me-2" onclick="goBack()"><i class="bi bi-arrow-left me-1"></i>返回</button>
                <button class="btn btn-outline-danger" onclick="logout()"><i class="bi bi-box-arrow-right me-1"></i>退出登录</button>
            </div>
        </div>
    </nav>
    <div class="main-box">
        <div class="main-title">公告管理</div>
        <form class="d-flex mb-4" id="addForm">
            <input type="text" class="form-control me-2" id="announcementInput" placeholder="输入新公告内容..." required>
            <button class="btn btn-primary" type="submit"><i class="bi bi-plus-circle me-1"></i>添加</button>
        </form>
        
        <!-- 搜索区域 -->
        <div class="search-section mb-4">
            <div class="row">
                <div class="col-md-8">
                    <input type="text" class="form-control" id="searchContent" placeholder="搜索公告内容...">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary" onclick="searchAnnouncements()">
                        <i class="bi bi-search me-1"></i>搜索
                    </button>
                    <button class="btn btn-outline-secondary ms-2" onclick="clearSearch()">
                        <i class="bi bi-x-circle me-1"></i>清除
                    </button>
                </div>
            </div>
        </div>
        
        <div id="announcementList"></div>
    </div>
    <script>
    // 登录态校验
    const user = JSON.parse(localStorage.getItem('user') || 'null');
    if (!user || (user.role !== 'ADMIN' && user.role !== 'EMPLOYEE')) {
        window.location.href = 'login.html';
    }
    function goBack() { window.location.href = user.role === 'ADMIN' ? 'admin-dashboard.html' : 'employee-dashboard.html'; }
    function logout() { localStorage.removeItem('user'); window.location.href = 'login.html'; }
    // 加载公告
    async function loadAnnouncements() {
        const res = await fetch('/api/announcements');
        const data = res.ok ? await res.json() : [];
        displayAnnouncements(data);
    }
    
    // 显示公告
    function displayAnnouncements(announcements) {
        const list = document.getElementById('announcementList');
        list.innerHTML = '';
        announcements.forEach(a => {
            const isLongAnnouncement = a.content.length > 100;
            const displayContent = isLongAnnouncement ? a.content.substring(0, 100) + '...' : a.content;
            
            list.innerHTML += `<div class="announcement-card">
                <div class="announcement-content">
                    <span id="content-${a.id}">${displayContent}</span>
                    ${isLongAnnouncement ? `<button class="btn btn-link btn-sm p-0 ms-2" onclick="toggleAnnouncement(${a.id}, '${a.content.replace(/'/g, "\\'")}')">查看详情</button>` : ''}
                </div>
                <button class="btn btn-outline-danger btn-sm" onclick="deleteAnnouncement(${a.id})"><i class="bi bi-trash"></i> 删除</button>
            </div>`;
        });
    }
    
    // 切换公告显示
    function toggleAnnouncement(id, fullContent) {
        const contentSpan = document.getElementById(`content-${id}`);
        const button = contentSpan.nextElementSibling;
        
        if (contentSpan.textContent.length > 100) {
            contentSpan.textContent = fullContent;
            button.textContent = '收起';
        } else {
            contentSpan.textContent = fullContent.substring(0, 100) + '...';
            button.textContent = '查看详情';
        }
    }
    
    // 搜索公告
    function searchAnnouncements() {
        const contentSearch = document.getElementById('searchContent').value.toLowerCase();
        
        fetch('/api/announcements')
            .then(res => res.json())
            .then(data => {
                const filteredAnnouncements = data.filter(a => {
                    return !contentSearch || (a.content && a.content.toLowerCase().includes(contentSearch));
                });
                displayAnnouncements(filteredAnnouncements);
            });
    }
    
    // 清除搜索
    function clearSearch() {
        document.getElementById('searchContent').value = '';
        loadAnnouncements();
    }
    
    // 添加公告
    document.getElementById('addForm').onsubmit = async function(e) {
        e.preventDefault();
        const content = document.getElementById('announcementInput').value.trim();
        if (!content) return;
        await fetch('/api/announcements', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        document.getElementById('announcementInput').value = '';
        loadAnnouncements();
    };
    // 删除公告
    async function deleteAnnouncement(id) {
        if (!confirm('确定要删除这条公告吗？')) return;
        await fetch('/api/announcements/' + id, { method: 'DELETE' });
        loadAnnouncements();
    }
    loadAnnouncements();
    </script>
</body>
</html> 